 function  [E,ksun]=uplanet_mick ( DAY, IBODY)
%---------------------------------------------------------------------
%
%  ANALYTICAL EPHEMERIDES FOR PLANETS - P. DYSLI, 1977.
%  PLANETARY ORBITAL ELEMENTS ARE RESTITUTED IN A SUN-CENTRED (EARTH-
%  CENTRED FOR THE MOON) EARTH ECLIPTIC SYSTEM.
%
%     OUTPUT :
%  E(1:6)     MEAN KEPLERIAN ELEMENTS OF DATE:
%  E(1)= semimajor axis
%  E(2)= eccentricity
%  E(3)= inclination (°)
%  E(4)= longitude of the ascending node
%  E(5)= pericenter anomaly
%  E(6)= true anomaly 
%  XM= mean angular velocity[deg/centuries]
%  ksun     GRAVITY CONSTANT OF THE SUN or OF THE EARTH
%     INPUT :
%  DAY      DAYS occurred from 1/1/2000 h 00.00
%  IBODY   NUMBER OF CELESTIAL BODY (< 12).
%
%
%  XREF: KEPEQU, UATRAP, UCONST, #CBASIC
%---------------------------------------------------------------------

PI2=2*pi;
PI=pi;
RAD=pi/180;
DEG=180/pi;

G=6.67259e-11;
msun=1.988919445342813e+030;
ksun=msun*G;

      FIRST=1;
      TOLD=-1e10;
%
      if (FIRST==1) 
        KM  = 149597870.66;
        FIRST =0;
      end
%
%  time reference shift from 2000 to 1950

            DAY = DAY + 18262;
            
%   time reference frame shift from 1950 h00 to 1900 h12

%   T = JULIAN CENTURIES SINCE 1900                     

      T   = (DAY + 18262.50)/36525.00;
      TT  = T*T;
      TTT = T*TT;
%
%  CLASSICAL PLANETARY ELEMENTS ESTIMATION IN MEAN ECLIPTIC OF DATE
%
      switch IBODY
%
%  MERCURY
%
   case 1 
      E(1) = 0.38709860;
      E(2) = 0.205614210 + 0.000020460*T - 0.000000030*TT;
      E(3) = 7.002880555555555560 + 1.86083333333333333e-3*T - 1.83333333333333333e-5*TT;
      E(4) = 4.71459444444444444e+1 + 1.185208333333333330*T + 1.73888888888888889e-4*TT;
      E(5) = 2.87537527777777778e+1 + 3.70280555555555556e-1*T +1.20833333333333333e-4*TT;
      XM   = 1.49472515288888889e+5 + 6.38888888888888889e-6*T;
      E(6) = 1.02279380555555556e2 + XM*T;
%
%  VENUS
%
   case 2
      E(1) = 0.72333160;
      E(2) = 0.006820690 - 0.000047740*T + 0.0000000910*TT;
      E(3) = 3.393630555555555560 + 1.00583333333333333e-3*T - 9.72222222222222222e-7*TT;
      E(4) = 7.57796472222222222e+1 + 8.9985e-1*T + 4.1e-4*TT;
      E(5) = 5.43841861111111111e+1 + 5.08186111111111111e-1*T -1.38638888888888889e-3*TT;
      XM   = 5.8517803875e+4 + 1.28605555555555556e-3*T;
      E(6) = 2.12603219444444444e2 + XM*T;
%
%  EARTH
%
   case 3
      E(1) = 1.000000230;
      E(2) = 0.016751040 - 0.000041800*T - 0.0000001260*TT;
      E(3) = 0.00;
      E(4) = 0.00;
      E(5) = 1.01220833333333333e+2 + 1.7191750*T + 4.52777777777777778e-4*TT + 3.33333333333333333e-6*TTT;
      XM   = 3.599904975e+4 - 1.50277777777777778e-4*T - 3.33333333333333333e-6*TT;
      E(6) = 3.58475844444444444e2 + XM*T;
%
%  MARS
%
   case 4
      E(1) = 1.5236883990;
      E(2) = 0.093312900 + 0.0000920640*T - 0.0000000770*TT;
      E(3) = 1.850333333333333330 - 6.75e-4*T + 1.26111111111111111e-5*TT;
      E(4) = 4.87864416666666667e+1 + 7.70991666666666667e-1*T - 1.38888888888888889e-6*TT - 5.33333333333333333e-6*TTT;
      E(5) = 2.85431761111111111e+2 + 1.069766666666666670*T +  1.3125e-4*TT + 4.13888888888888889e-6*TTT;
      XM   = 1.91398585e+4 + 1.80805555555555556e-4*T + 1.19444444444444444e-6*TT;
      E(6) = 3.19529425e2 + XM*T;
        
%
%  JUPITER
%
   case 5
      E(1) = 5.2025610;
      E(2) = 0.048334750 + 0.000164180*T  - 0.00000046760*TT -0.00000000170*TTT;
      E(3) = 1.308736111111111110 - 5.69611111111111111e-3*T +  3.88888888888888889e-6*TT;
      E(4) = 9.94433861111111111e+1 + 1.010530*T + 3.52222222222222222e-4*TT - 8.51111111111111111e-6*TTT;
      E(5) = 2.73277541666666667e+2 + 5.99431666666666667e-1*T + 7.0405e-4*TT + 5.07777777777777778e-6*TTT;
      XM   = 3.03469202388888889e+3 - 7.21588888888888889e-4*T + 1.78444444444444444e-6*TT;
      E(6) = 2.25328327777777778e2 + XM*T;
%
%  SATURN
%
   case 6
      E(1) = 9.5547470;
      E(2) = 0.055892320 - 0.00034550*T - 0.0000007280*TT + 0.000000000740*TTT;
      E(3) = 2.492519444444444440 - 3.91888888888888889e-3*T - 1.54888888888888889e-5*TT + 4.44444444444444444e-8*TTT;
      E(4) = 1.12790388888888889e+2 + 8.73195138888888889e-1*T -1.52180555555555556e-4*TT - 5.30555555555555556e-6*TTT;
      E(5) = 3.38307772222222222e+2 + 1.085220694444444440*T + 9.78541666666666667e-4*TT + 9.91666666666666667e-6*TTT;
      XM   = 1.22155146777777778e+3 - 5.01819444444444444e-4*T - 5.19444444444444444e-6*TT;
      E(6) = 1.75466216666666667e2 + XM*T;
%
%  URANUS
%
   case 7
      E(1) = 19.218140;
      E(2) = 0.04634440 - 0.000026580*T + 0.0000000770*TT;
      E(3) = 7.72463888888888889e-1 + 6.25277777777777778e-4*T + 3.95e-5*TT;
      E(4) = 7.34770972222222222e+1 + 4.98667777777777778e-1*T + 1.31166666666666667e-3*TT;
      E(5) = 9.80715527777777778e+1 + 9.85765e-1*T - 1.07447222222222222e-3*TT - 6.05555555555555556e-7*TTT;
      XM   = 4.28379113055555556e+2 + 7.88444444444444444e-5*T + 1.11111111111111111e-9*TT;
      E(6) = 7.26488194444444444e1 + XM*T;
%
%  NEPTUNE
%
   case 8
      E(1) = 30.109570;
      E(2) = 0.008997040 + 0.0000063300*T - 0.0000000020*TT;
      E(3) = 1.779241666666666670 - 9.54361111111111111e-3*T - 9.11111111111111111e-6*TT;
      E(4) = 1.30681358333333333e+2 + 1.0989350*T + 2.49866666666666667e-4*TT - 4.71777777777777778e-6*TTT;
      E(5) = 2.76045966666666667e+2 + 3.25639444444444444e-1*T + 1.4095e-4*TT + 4.11333333333333333e-6*TTT;
      XM   = 2.18461339722222222e+2 - 7.03333333333333333e-5*T;
      E(6) = 3.77306694444444444e1 + XM*T;
%
%  PLUTO
%
   case 9
      TP   = (DAY - 72780)/200.00;
      E(1) =  39.756410   - 0.000368750  *TP;
      E(2) =   0.25342450 + 0.00030306250*TP;
      E(3) =  17.138620   + 0.003200     *TP;
      E(4) = 109.8960     + 0.0316250    *TP;
      E(5) = 113.11850    + 0.102250     *TP;
      XM   =   0.786360   + 0.000020     *TP;
      E(6) = 331.90190    + XM            *TP;
      XM   = XM/2000*365250;
%
%  SUN
%
  case 10
      for I = 1: 6
         E(I)     = 0;
      end
%
%  MOON (AROUND EARTH)
%
  case 11
      msun=59.736e23;
      ksun=msun*G;
      E(1) = 0.0025695549067660;
      E(2) = 0.0549004890;
      E(3) = 5.145396388888888890;
      E(4) = 2.59183275e+2  - 1.93414200833333333e+3*T + 2.07777777777777778e-3*TT + 2.22222222222222222e-6*TTT;
      E(4) = mod(E(4) + 108e3, 360);
      E(5) = 7.51462805555555556e+1    + 6.00317604166666667e+3*T - 1.24027777777777778e-2*TT - 1.47222222222222222e-5*TTT;
      E(5) = mod(E(5), 360);
      XM   = 4.77198849108333333e+5    + 9.19166666666666667e-3*T  + 1.43888888888888889e-5*TT;
      E(6) = 2.96104608333333333e2     + XM                    *T;
      
      
 case 12 %Apophis
      %   time reference frame shift from 2000 h00 to 26/11/2005 h12
        J2005=julday_mick([26 11 2005 0.5]);
        J2000=julday_mick([01 01 2000 0.5]);
        delta=J2005-J2000;
        TP = (DAY-delta)/36525;
        E(1) = 0.92242;
        E(2)=  0.191015;
        E(3)= 3.331;
        E(4)= 204.466;
        E(5)= 126.364;
        % XM= mean angular velocity [deg/centuries]
        % (sqrt(mu/a^3))*(86400*36525)/(pi/180)
        XM = 4.063318606071614e+004;
        E(6)= mod(deg2rad(111 + XM*TP), 2*pi);
   
      end
   
      
% parameters linear perturbation model updated at 2000

% case i of
%     value 1: % Mercury
%         p.a := 0.38709893 + 0.00000066*cy
%         p.e := 0.20563069 + 0.00002527*cy
%         p.i := ( 7.00487  -  23.51*cy/3600)*rads
%         p.O := (48.33167  - 446.30*cy/3600)*rads
%         p.w := (77.45645  + 573.57*cy/3600)*rads
%         p.L := mod2pi((252.25084 + 538101628.29*cy/3600)*rads)
%     value 2: % Venus
%         p.a := 0.72333199 + 0.00000092*cy
%         p.e := 0.00677323 - 0.00004938*cy
%         p.i := (  3.39471 -   2.86*cy/3600)*rads
%         p.O := ( 76.68069 - 996.89*cy/3600)*rads
%         p.w := (131.53298 - 108.80*cy/3600)*rads
%         p.L := mod2pi((181.97973 + 210664136.06*cy/3600)*rads)
%     value 3: % Earth/Sun
%         p.a := 1.00000011 - 0.00000005*cy
%         p.e := 0.01671022 - 0.00003804*cy
%         p.i := (  0.00005 -    46.94*cy/3600)*rads
%         p.O := (-11.26064 - 18228.25*cy/3600)*rads
%         p.w := (102.94719 +  1198.28*cy/3600)*rads
%         p.L := mod2pi((100.46435 + 129597740.63*cy/3600)*rads)
%     value 4: % Mars
%         p.a := 1.52366231 - 0.00007221*cy
%         p.e := 0.09341233 + 0.00011902*cy
%         p.i := (  1.85061 -   25.47*cy/3600)*rads
%         p.O := ( 49.57854 - 1020.19*cy/3600)*rads
%         p.w := (336.04084 + 1560.78*cy/3600)*rads
%         p.L := mod2pi((355.45332 + 68905103.78*cy/3600)*rads)
%     value 5: % Jupiter
%         p.a := 5.20336301 + 0.00060737*cy
%         p.e := 0.04839266 - 0.00012880*cy
%         p.i := (  1.30530 -    4.15*cy/3600)*rads
%         p.O := (100.55615 + 1217.17*cy/3600)*rads
%         p.w := ( 14.75385 +  839.93*cy/3600)*rads
%         p.L := mod2pi((34.40438 + 10925078.35*cy/3600)*rads)
%     value 6: % Saturn
%         p.a := 9.53707032 - 0.00301530*cy
%         p.e := 0.05415060 - 0.00036762*cy
%         p.i := (  2.48446 +    6.11*cy/3600)*rads
%         p.O := (113.71504 - 1591.05*cy/3600)*rads
%         p.w := ( 92.43194 - 1948.89*cy/3600)*rads
%         p.L := mod2pi((49.94432 + 4401052.95*cy/3600)*rads)
%     value 7: % Uranus
%         p.a := 19.19126393 + 0.00152025*cy
%         p.e :=  0.04716771 - 0.00019150*cy
%         p.i := (  0.76986  -    2.09*cy/3600)*rads
%         p.O := ( 74.22988  - 1681.40*cy/3600)*rads
%         p.w := (170.96424  + 1312.56*cy/3600)*rads
%         p.L := mod2pi((313.23218 + 1542547.79*cy/3600)*rads)
%     value 8: % Neptune
%         p.a := 30.06896348 - 0.00125196*cy
%         p.e :=  0.00858587 + 0.00002510*cy
%         p.i := (  1.76917  -   3.64*cy/3600)*rads
%         p.O := (131.72169  - 151.25*cy/3600)*rads
%         p.w := ( 44.97135  - 844.43*cy/3600)*rads
%         p.L := mod2pi((304.88003 + 786449.21*cy/3600)*rads)
%     value 9: % Pluto
%         p.a := 39.48168677 - 0.00076912*cy
%         p.e :=  0.24880766 + 0.00006465*cy
%         p.i := ( 17.14175  +  11.07*cy/3600)*rads
%         p.O := (110.30347  -  37.33*cy/3600)*rads
%         p.w := (224.06676  - 132.25*cy/3600)*rads
%         p.L := mod2pi((238.92881 + 522747.90*cy/3600)*rads)



%  CONVERSION OF AU INTO KM, DEG INTO RAD AND DEFINITION OF  XMU
%
      E(1)     = E(1)*KM;
      for  I = 3: 6
         E(I)     = E(I)*RAD;
      end
      E(6)     = mod(E(6), PI2);
      XMU      = (XM*RAD/(864000*365250))^2*E(1)^3;
     %end of classical formulation
     
      phi=E(6);
     
%eccentric anomaly computation      
for i=1:100
    ddf=(E(2)*cos(phi(i))-1);
   phi(i+1)=phi(i)-(E(6)-phi(i)+E(2)*sin(phi(i)))/ddf;
      tol=abs(phi(i+1)-phi(i));
   if tol<1e-7
       break
   else
   end
end 

ns=length(phi);
phi=phi(ns);
%true anomaly computation   
theta=2*atan(sqrt((1+E(2))/(1-E(2)))*tan(phi/2));

E(6)=theta;
 
for  I = 3: 6
         E(I)     = E(I)/RAD;
      end
       E(6)     = mod(E(6), 360);
 return
